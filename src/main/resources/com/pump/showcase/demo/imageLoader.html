<!DOCTYPE html>
<html>
<head>
<title>ImageLoader Demo</title>
</head>
<body>
<h1>ImageLoader Demo</h1>
<h2>What Is It</h2>
<p>The <code>ImageLoader</code> converts a <code>java.awt.Image</code> into a <code>java.awt.image.BufferedImage</code>.</p>
<h2>How To Use It</h2>
<p>There are three static methods:</p>
<pre>public MutableBufferedImage createImage(Image image)
public MutableBufferedImage createImage(File file)
public MutableBufferedImage createImage(URL url)</pre>
<p>Also three additional methods let you specify the image type (like <code>BufferedImage.TYPE_INT_ARGB</code>, or <code>BufferedImage.TYPE_3BYTE_BGR</code>):</p>
<pre>public MutableBufferedImage createImage(Image image, int imageType)
public MutableBufferedImage createImage(File file, int imageType)
public MutableBufferedImage createImage(URL url, int imageType)</pre>
<h2>How It Works</h2>
<p>It calls <code>Image.getSource()</code> to identify the <code>ImageProducer</code>. Then it attaches a custom <code>ImageConsumer</code> and populates a <code>BufferedImage</code> as image data becomes available.</p>
<p>If you specify a specific image type then the <code>com.pump.image.pixel.ImageType</code> classes are used to convert from one pixel type to another.</code>
<h2>Discussion</h2>
<p>Nothing about this class is especially clever, but it manages a lot of the tedious nuts and bolts of managing pixel data for you.</p>
<p>Originally I intended for the <code>ImageLoader</code> class to be an alternative to the <code>MediaTracker</code> class. But now with hindsight: now I think the <code>ImageLoader</code> is mostly an alternative to loading images with <code>ImageIO</code>. Both approaches produces a <code>BufferedImage</code>, which is nearly always what I prefer instead of a cryptic <code>java.awt.Image</code> from the <code>Toolkit</code>.</p>
<p>I'm not an expert regarding the <code>MediaTracker</code>, but I poked around a little bit and I found that internally it actually has a very similar approach to the <code>ImageLoader</code>: the <code>sun.awt.image.ImageRepresentation</code> also listens for pixel data and constructs a similar <code>BufferedImage</code>. If that class were part of the Java API I might not written the <code>ImageLoader</code>, but as it stands now: that class remains part of the <code>sun</code> package (although it is <code>public<code>).</p>
<p>Once I realized I was comparing the <code>ImageLoader</code> to <code>ImageIO</code>: I considered discarding the <code>ImageLoader</code>. They produce the same BufferedImage, and obviously <code>ImageIO</code> has a lot more work put into it. (You can swap parsers, read metadata, etc.) But to my surprise when I started measuring performance: it outperformed <code>ImageIO</code> by a small but constant margin. As of this writing (summer of 2022) when I measure the time it takes to load a large JPG on my Mac the results resemble:</p>
<br><img src="data:image/jvg;base64,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" alt="ImageLoader takes 1.1 s, ImageIO takes 1.2 s, and MediaTracker takes 1.3 s. Regarding memory ImageLoader takes 16.4 MB, ImageIO takes 23.3 MB, and MediaTracker takes 31.8 MB."/>
<p>Another JPG, though, produced startling results like this:</p>
<br><img src="data:image/jvg;base64,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" alt="ImageLoader and MediaTracker took under 5 seconds, and ImageIO took over 40 seconds."/>
<p>I'm not sure what the difference in those images is, though. They're both a similar size. Maybe I'm not intimate enough with the inner workings of JPEG compression, and there's an internal difference that requires different resources to parse? I tried graphing the three parsing models as the width increased:</p>
<img src="data:image/jvg;base64,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" alt="This shows all 3 model tracking upwards at a similar rate. The ImageLoader is slightly outperforming the MediaTracker and then ImageIO, but not by a significant margin."/>
<br>(In this particular test: the height was a constant of 1,000px. The image was the same (but scaled). The JPEG quality was 50%. I tried varying the JPEG quality but that didn't make a difference.)
<p>So as of this writing: I'm confident in saying the <code>ImageLoader</code> is a little bit more efficient. In some (maybe rare?) cases it is a lot more efficient, but I don't understand what separates those cases.</p>
</body>
</html>