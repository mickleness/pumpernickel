<!DOCTYPE html>
<html>
<head>
<title>ImageLoader Demo</title>
</head>
<body>
<h1>ImageLoader Demo</h1>
<h2>What Is It</h2>
<p>The <code>ImageLoader</code> converts a <code>java.awt.Image</code> into a <code>java.awt.image.BufferedImage</code>.</p>
<h2>How To Use It</h2>
<p>There are three static methods:</p>
<pre>public MutableBufferedImage createImage(Image image)
public MutableBufferedImage createImage(File file)
public MutableBufferedImage createImage(URL url)</pre>
<p>Also three additional methods let you specify the image type (like <code>BufferedImage.TYPE_INT_ARGB</code>, or <code>BufferedImage.TYPE_3BYTE_BGR</code>):</p>
<pre>public MutableBufferedImage createImage(Image image, int imageType)
public MutableBufferedImage createImage(File file, int imageType)
public MutableBufferedImage createImage(URL url, int imageType)</pre>
<h2>How It Works</h2>
<p>It calls <code>Image.getSource()</code> to identify the <code>ImageProducer</code>. Then it attaches a custom <code>ImageConsumer</code> and populates a <code>BufferedImage</code> as image data becomes available.</p>
<p>If you specify a specific image type then the <code>com.pump.image.pixel.ImageType</code> classes are used to convert from one pixel type to another.</code>
<h2>Discussion</h2>
<p>Nothing about this class is especially clever, but it manages a lot of the tedious nuts and bolts of managing pixel data for you.</p>
<p>Originally I intended for the <code>ImageLoader</code> class to be an alternative to the <code>MediaTracker</code> class. But now with hindsight: now I think the <code>ImageLoader</code> is mostly an alternative to loading images with <code>ImageIO</code>. Both approaches produces a <code>BufferedImage</code>, which is nearly always what I prefer instead of a cryptic <code>java.awt.Image</code> from the <code>Toolkit</code>.</p>
<p>I'm not an expert regarding the <code>MediaTracker</code>, but I poked around a little bit and I found that internally it actually has a very similar approach to the <code>ImageLoader</code>: the <code>sun.awt.image.ImageRepresentation</code> also listens for pixel data and constructs a similar <code>BufferedImage</code>. If that class were part of the Java API I might not written the <code>ImageLoader</code>, but as it stands now: that class remains part of the <code>sun</code> package (although it is <code>public<code>).</p>
<p>Once I realized I was comparing the <code>ImageLoader</code> to <code>ImageIO</code>: I considered discarding the <code>ImageLoader</code>. They produce the same BufferedImage, and obviously <code>ImageIO</code> has a lot more work put into it. (You can swap parsers, read metadata, etc.) But to my surprise when I started measuring performance: it outperformed <code>ImageIO</code> by a small but constant margin. As of this writing (summer of 2022) when I measure the time it takes to load a large JPG on my Mac the results resemble:</p>
<br><img src="data:image/jvg;base64,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" alt="ImageLoader takes 1.1 s, ImageIO takes 1.2 s, and MediaTracker takes 1.3 s. Regarding memory ImageLoader takes 16.4 MB, ImageIO takes 23.3 MB, and MediaTracker takes 31.8 MB."/>
<p>Another JPG, though, produced startling results like this:</p>
<br><img src="data:image/jvg;base64,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" alt="ImageLoader and MediaTracker took under 5 seconds, and ImageIO took over 40 seconds."/>
<p>I'm not sure what the difference in those images is, though. They're both a similar size. Maybe I'm not intimate enough with the inner workings of JPEG compression, and there's an internal difference that requires different resources to parse? I tried graphing the three parsing models as the width increased:</p>
<img src="data:image/jvg;base64,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" alt="This shows all 3 model tracking upwards at a similar rate. The ImageLoader is slightly outperforming the MediaTracker and then ImageIO, but not by a significant margin."/>
<br>(In this particular test: the height was a constant of 1,000px. The image was the same (but scaled). The JPEG quality was 50%. I tried varying the JPEG quality but that didn't make a difference.)
<p>So as of this writing: I'm confident in saying the <code>ImageLoader</code> is a little bit more efficient. In some (maybe rare?) cases it is a lot more efficient, but I don't understand what separates those cases.</p>
</body>
</html>